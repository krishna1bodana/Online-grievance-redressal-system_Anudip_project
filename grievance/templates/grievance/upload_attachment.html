{% extends 'base.html' %}

{% block title %}Upload Attachment | Case #{{ grievance.id }}{% endblock %}

{% block content %}
<div class="row justify-content-center align-items-center" style="min-height: 70vh;">
    <div class="col-lg-6 col-md-8">

        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'grievance:my_grievances' %}">My Grievances</a></li>
                <li class="breadcrumb-item"><a href="{% url 'grievance:grievance_detail' grievance.id %}">Case Details</a></li>
                <li class="breadcrumb-item active">Upload Evidence</li>
            </ol>
        </nav>

        <div class="card shadow border-0">
            <div class="card-body p-4 p-lg-5">

                <div class="text-center mb-4">
                    <div class="bg-primary-subtle text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                        <i class="fas fa-file-upload fa-lg"></i>
                    </div>
                    <h4 class="fw-bold">Upload Evidence</h4>
                    <p class="text-muted small">
                        Attach documents, photos, or PDFs related to: <br>
                        <span class="text-dark fw-bold">"{{ grievance.title }}"</span>
                    </p>
                </div>

                <form method="post" enctype="multipart/form-data" id="uploadForm" novalidate>
                    {% csrf_token %}

                    {% for field in form %}
                        <div class="mb-4">
                            <label for="{{ field.id_for_label }}" class="form-label fw-bold small">Select File</label>
                            
                            {# The form-control class is applied here for Bootstrap styling #}
                            <div class="input-group">
                                {{ field }}
                            </div>

                            {% if field.help_text %}
                                <div class="form-text x-small mt-1">{{ field.help_text }}</div>
                            {% endif %}

                            {% if field.errors %}
                                {% for error in field.errors %}
                                    <div class="text-danger x-small mt-1 fw-bold">
                                        <i class="fas fa-exclamation-circle me-1"></i> {{ error|striptags }}
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    {% endfor %}

                    <div class="alert alert-light border small text-muted mb-4">
                        <i class="fas fa-info-circle me-2"></i>
                        Supported formats: JPG, PNG, PDF, DOCX. Max size: 5MB.
                    </div>

                    <div class="d-grid">
                        <button type="submit" id="uploadBtn" class="btn btn-primary py-2 fw-bold shadow-sm">
                            Start Upload <i class="fas fa-arrow-up-from-bracket ms-2"></i>
                        </button>
                    </div>
                </form>

                <div class="text-center mt-4">
                    <a href="{% url 'grievance:grievance_detail' grievance.id %}" class="text-muted small text-decoration-none">
                        <i class="fas fa-times me-1"></i> Cancel and go back
                    </a>
                </div>

            </div>
        </div>

    </div>
</div>

<script>
    document.getElementById('uploadForm').addEventListener('submit', function() {
        const btn = document.getElementById('uploadBtn');
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Uploading File...';
    });
</script>
{% endblock %}